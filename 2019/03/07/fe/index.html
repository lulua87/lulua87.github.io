<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="前端开发涉及面很广，最近想做一个关于前端开发模式迭代的总结分享，由于近些年前端开发的框架和构建打包工具层出不穷，让人眼花缭乱，而这些框架或者工具的最终目的是为了提升开发效率、提升代码可维护性。前面先会简单过一下前端大而全的一些东西，后面会逐渐讲一些开发中实用的前端开发模式和框架，顺便回顾一下近些年来开发过的项目，最后做一下总结。">
<meta property="og:type" content="article">
<meta property="og:title" content="前端开发模式总结">
<meta property="og:url" content="http://example.com/2019/03/07/fe/index.html">
<meta property="og:site_name" content="前端记录">
<meta property="og:description" content="前端开发涉及面很广，最近想做一个关于前端开发模式迭代的总结分享，由于近些年前端开发的框架和构建打包工具层出不穷，让人眼花缭乱，而这些框架或者工具的最终目的是为了提升开发效率、提升代码可维护性。前面先会简单过一下前端大而全的一些东西，后面会逐渐讲一些开发中实用的前端开发模式和框架，顺便回顾一下近些年来开发过的项目，最后做一下总结。">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/download/attachments/690531984/tpl.jpg?version=1&modificationDate=1550563548667&api=v2">
<meta property="article:published_time" content="2019-03-07T07:50:00.000Z">
<meta property="article:modified_time" content="2020-12-06T03:54:00.000Z">
<meta property="article:author" content="Gao lu">
<meta property="article:tag" content="框架">
<meta property="article:tag" content="构建打包">
<meta property="article:tag" content="前端开发模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/download/attachments/690531984/tpl.jpg?version=1&modificationDate=1550563548667&api=v2">

<link rel="canonical" href="http://example.com/2019/03/07/fe/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>前端开发模式总结 | 前端记录</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">前端记录</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/03/07/fe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gao lu">
      <meta itemprop="description" content="时间就像一张网，你撒在哪里，你的收获就在哪里。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端记录">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          前端开发模式总结
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-03-07 15:50:00" itemprop="dateCreated datePublished" datetime="2019-03-07T15:50:00+08:00">2019-03-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-06 11:54:00" itemprop="dateModified" datetime="2020-12-06T11:54:00+08:00">2020-12-06</time>
              </span>

          
            <div class="post-description">前端开发涉及面很广，最近想做一个关于前端开发模式迭代的总结分享，由于近些年前端开发的框架和构建打包工具层出不穷，让人眼花缭乱，而这些框架或者工具的最终目的是为了提升开发效率、提升代码可维护性。前面先会简单过一下前端大而全的一些东西，后面会逐渐讲一些开发中实用的前端开发模式和框架，顺便回顾一下近些年来开发过的项目，最后做一下总结。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>前端开发涉及面很广，最近想做一个关于前端开发模式迭代的总结分享，由于近些年前端开发的框架和构建打包工具层出不穷，让人眼花缭乱，而这些框架或者工具的最终目的是为了提升开发效率、提升代码可维护性。前面先会简单过一下前端大而全的一些东西，后面会逐渐讲一些开发中实用的前端开发模式和框架，顺便回顾一下近些年来开发过的项目，最后做一下总结。</p>
<h2 id="二、前端三要素：HTML、CSS、JS"><a href="#二、前端三要素：HTML、CSS、JS" class="headerlink" title="二、前端三要素：HTML、CSS、JS"></a>二、前端三要素：HTML、CSS、JS</h2><p>1、HTML可以看做是一个房子的骨架，结构。<br>2、如果说HTML是房子的骨架，那么CSS就是房子的外观。<br>3、那么一些负责交互、功能性质的工作就得交给Javascript了！其中，js由三部分组成：ECMAScript（ES，语法、标准规范） + DOM（文档对象模型）+ BOM（浏览器对象模型）。</p>
<h3 id="HTML之于模板引擎"><a href="#HTML之于模板引擎" class="headerlink" title="HTML之于模板引擎"></a>HTML之于模板引擎</h3><p>除了静态网站，大部分网站数据来源于后端，通过某种方式输出到页面，这里后面会讲到。由此，模板的诞生是为了将显示与数据分离，例如后端模板<a target="_blank" rel="noopener" href="https://www.smarty.net/">smarty</a>、前端JS模板<a target="_blank" rel="noopener" href="http://baidufe.github.io/BaiduTemplate/">BaiduTemplate</a>，模板技术多种多样，但其本质是将模板文件和数据通过模板引擎生成最终的HTML代码。<br><img src="/download/attachments/690531984/tpl.jpg?version=1&modificationDate=1550563548667&api=v2"></img></p>
<h3 id="JS、CSS之于ES6-Es7-TypeScript、Less-Sass-Stylus"><a href="#JS、CSS之于ES6-Es7-TypeScript、Less-Sass-Stylus" class="headerlink" title="JS、CSS之于ES6/Es7/TypeScript、Less/Sass/Stylus"></a>JS、CSS之于ES6/Es7/TypeScript、Less/Sass/Stylus</h3><p>原生JS、CSS被浏览器原生支持，但是这些原生语言有他们的弊端：<br>1、JS有这些被诟病的“痛点”：弱类型和没有命名空间，导致很难模块化，不适合开发大型应用；<br>2、CSS不支持模块化、变量、Mixin(混入)等实用功能，随着网站复杂度越来越高，同时考虑项目维护成本，使用更高级的语言势在必行。<br>因此为了提升开发效率，我们一般使用更方便开发、更好维护、支持模块化的语言，JS-&gt;ECMAScript 6（ES6、ES7,下一代标准）、TypeScript（JS的超集）, CSS-&gt;CSS预处理语言(Less、Sass/Scss、Stylus等)。</p>
<p>如下图，通过编译工具(例如<a target="_blank" rel="noopener" href="https://www.webpackjs.com/">Webpack</a>)，这些高级语言最终编译为浏览器可直接运行的为JS、CSS。<br><img src=""></img></p>
<p style="margin-left:350px;">借助编译工具</p>

<h2 id="三、应用形态"><a href="#三、应用形态" class="headerlink" title="三、应用形态"></a>三、应用形态</h2><p>一、从移动端和PC端来区分，主要分为：</p>
<h3 id="1、移动应用"><a href="#1、移动应用" class="headerlink" title="1、移动应用"></a>1、移动应用</h3><p><img src=""></img></p>
<h4 id="1-Web-App"><a href="#1-Web-App" class="headerlink" title="1. Web App"></a>1. Web App</h4><p>Web App即移动端的网站，将页面部署在服务器上，然后用户使用各大浏览器访问。一般泛指 SPA(Single Page Application)模式开发出的网站。</p>
<h4 id="2-Native-App"><a href="#2-Native-App" class="headerlink" title="2. Native App"></a>2. Native App</h4><p>Native App即传统的原生APP开发模式，Android基于Java语言，底层调用Google的 API；iOS基于OC或者Swift语言，底层调用App官方提供的API。不在本次讨论范围内。</p>
<h4 id="3-Hybrid-App，介于Web-App和Native-App"><a href="#3-Hybrid-App，介于Web-App和Native-App" class="headerlink" title="3. Hybrid App，介于Web App和Native App"></a>3. Hybrid App，介于Web App和Native App</h4><p>这里简单讲一下近些年流行的一种开发模式——Hybrid App。众所周知，原生APP开发中有一个<code>webview</code>的组件(Android中是webview，iOS7以下有UIWebview、7以上有WKWebview)，这个组件可以加载Html文件。反过来，Html页面利用<code>JSBridge</code>，可以调用Native的api，达到与原生APP基本一致的用户体验，例如拍照存储，本地相册上传等操作。</p>
<p><img src=""></img></p>
<p>如上图，这种Hybrid混合开发模式，由Native通过JSBridge等方法提供统一的API，然后用Html5+JS来写实际的逻辑，可去调用Native API。在这种模式下，由于Android、iOS的API对外暴露出的一致性、且最终的页面在webview中显示，故此达到<code>跨平台</code>的目的。</p>
<h3 id="2、PC-Web-应用"><a href="#2、PC-Web-应用" class="headerlink" title="2、PC Web 应用"></a>2、PC Web 应用</h3><p>这里忽略。</p>
<p>二、从页面跳转形式来看，主要分为：</p>
<h3 id="1-单页面应用（SinglePage-Web-Application，SPA）"><a href="#1-单页面应用（SinglePage-Web-Application，SPA）" class="headerlink" title="1.单页面应用（SinglePage Web Application，SPA）"></a>1.单页面应用（SinglePage Web Application，SPA）</h3><p>只有一张Web页面的应用，单页面跳转仅刷新局部资源 ，公共资源(js、css等)仅需加载一次，常用于PC端官网、购物等网站。<br>如下图:<br><img src=""></img></p>
<p><span style="display:inline-block;margin-left:230px;">单页面应用结构视图</span></p>

<h3 id="2-多页面应用（MultiPage-Application，MPA）"><a href="#2-多页面应用（MultiPage-Application，MPA）" class="headerlink" title="2.多页面应用（MultiPage Application，MPA）"></a>2.多页面应用（MultiPage Application，MPA）</h3><p>多页面跳转刷新所有资源，每个公共资源(js、css等)需选择性重新加载。<br>如下图:<br><img src=""></img></p>
<p><span style="display:inline-block;margin-left:230px;">多页面应用结构视图</span></p>

<h2 id="四、前端开发模式的迭代"><a href="#四、前端开发模式的迭代" class="headerlink" title="四、前端开发模式的迭代"></a>四、前端开发模式的迭代</h2><p>前端开发给人的印象一直是变化太快，新的框架、库、构建工具、开发模式层出不穷。<br><img src=""></img></p>
<h3 id="一、传统开发模式"><a href="#一、传统开发模式" class="headerlink" title="一、传统开发模式"></a>一、传统开发模式</h3><p>Application Server 负责提供动态内容，浏览器发起请求后，由 Application Server 返回 <code>HTML 文档</code> 或 <code>JSON 数据</code>，浏览器解析到 HTML 内的 script、link、img 等资源标签时，会发起资源文件的请求，静态资源 URL 通常会加上专门的域名解析到静态资源 Server，对于小型 Web 系统，Application Server 和静态资源 Server 会由同一个 Web Server 来承载。</p>
<p><img src=""></img></p>
<p><span style="color:red">动态HTML</span>衍生出了两种传统的前端开发模式：<br>1、HTML 混合在 Server 端程序代码中：<br>这种模式下的协作方式通常是由前端工程师开发好静态页面，再交给后端工程师『套页面』，最后产出一个包含 Server 端程序代码和 HTML 的代码文件，浏览器请求时由 Server 端程序执行代码文件，获取数据、拼接 HTML 片段生成完整的 HTML 文档。缺点很明显就是前后端未分离，协作效率极低。<br>2、通过 Server 端模板引擎生成 HTML：<br>模板引擎的出现为前后端提供了更好的协作方式，它是一个运行在 Server 端应用程序中的组件，能清晰的将前端代码与 Server 端程序代码分离。</p>
<p>以基于 PHP 的 Smarty 模板引擎为例，如下图</p>
<p><img src="">smarty模板demo</span></p></p>
<p>调用 assign 方法向模板中传递变量/对象，调用 display 方法来显示模板，生成 HTML。<br>assign 和 display 确定了前后端的衔接方式：约定一份模板变量、一个模板文件路径。</p>
<h3 id="二、前后端分离"><a href="#二、前后端分离" class="headerlink" title="二、前后端分离"></a>二、前后端分离</h3><p>Application Server 提供的动态内容除了 HTML，还可以是<span style="color:red">JSON</span>数据，这又衍生出另一种开发模式：前后端分离。</p>
<p>前后端分离带来了巨大的好处：</p>
<blockquote>
<p>1.后端工程师只负责提供 API 接口，可以专注于 API 的实现。<br>2.一套 API 可以提供给浏览器、IOS、Android 等多端使用。<br>3.前后端可以完全分开部署，后端不用再承担模板渲染、页面路由配置等 UI 层的工作。<br>4.前端可以把控用户交互、页面路由、内容渲染的整个过程，在开发效率、功能实现方案、用户体验上会有更大的探索空间。</p>
</blockquote>
<p>前后端分离有两种模式：<br>1、基于 Node 的前后端分离<br>2、单页 Web 应用（SPA， Single-page application）</p>
<h4 id="基于-Node-的前后端分离"><a href="#基于-Node-的前后端分离" class="headerlink" title="基于 Node 的前后端分离"></a>基于 Node 的前后端分离</h4><p>基于 Node 的前后端分离依然会有 Server 端渲染页面的逻辑，只是这个 Server 端是由前端工程师通过 Node 搭建的，整体流程如下：<br><img src=""></img></p>
<p>浏览器发起的请求由 Node Server 来处理，Node Server 接收到请求后访问相应的 API Server 获取数据，再生成 HTML 文档返回给浏览器。<br>开发 Server 端应用就需要有一个 Server 端的应用框架，基于 Node 的应用框架有很多，包括：Express、Koa、阿里的 Egg、百度的 Yog2 等等。这个第五章的第5小节会讲到。</p>
<h4 id="单页-Web-应用-SinglePage-Web-Application，SPA"><a href="#单页-Web-应用-SinglePage-Web-Application，SPA" class="headerlink" title="单页 Web 应用(SinglePage Web Application，SPA)"></a>单页 Web 应用(SinglePage Web Application，SPA)</h4><p>单页 Web 应用通常没有 Server 端渲染模板的逻辑，前端产出的都是静态资源，整体流程如下：<br><img src=""></img></p>
<p>浏览器访问应用的各个 URL 时 Web Server 都会 rewrite 到一个静态 HTML：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    root /home/www/app;</span><br><span class="line">    index index.html;</span><br><span class="line">    <span class="comment">// !-f用来判断是否存在文件 ；$request_filename:当前请求的文件路径，由root或alias指令与URI请求生成</span></span><br><span class="line">    <span class="keyword">if</span> (!-f $request_filename) &#123;</span><br><span class="line">        <span class="comment">// 通配符正则，匹配到任何路径，均重写到/index.html</span></span><br><span class="line">        rewrite ^(.*)$ /index.html <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是一般情况下，前端在本地开发，也可以有多种方式来启动一个Web Server服务，例如利用Node.js配合<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/http-server">http-server</a>、或者<a target="_blank" rel="noopener" href="https://www.gulpjs.com.cn/docs/recipes/server-with-livereload-and-css-injection/">Glup配合BrowserSync</a>可以快速启动一个本地服务。</p>
<p>这个 HTML 通常没有内容，只是一个加载 JS 的页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>vue-demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/index.md5.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ontouchstart</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/index.md5.js&quot;</span>&gt;</span><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">script</span>/&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span></span><br><span class="line"></span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure>

<p>单页 Web 应用与普通网站的重要区别是：普通网站的入口是 HTML，而单页 Web 应用的入口实则是 JS，由 JS 解析路由、从 API Server 取数据、渲染内容。</p>
<p>具体到应用的开发，依然需要有开发规范与框架的支撑，主流的技术栈包括：Angular、React、Vue。这个第五章会讲到。</p>
<h2 id="五、不同类型项目回顾"><a href="#五、不同类型项目回顾" class="headerlink" title="五、不同类型项目回顾"></a>五、不同类型项目回顾</h2><p>随着业务的不同，每段时期前端团队的分化点如下：<br>1、重型SPA页面，重业务逻辑复杂，iframe集成（糯米营销mis）。<br>2、Hybrid方式的Web页面，糯米APP，发布升级免审核，注重组件化开发、跨平台性、贴近原生。<br>3、活动页面，例如糯米3.7女生节、5.7吃货节，主要活动形式摇一摇、秒杀（糯米节日大促）。<br>4、H5小游戏，例如红包雨、捉螃蟹、堆蛋糕，优惠券、积分、红包等激励（糯米拉新留存）。<br>5、移动端H5内容检索类，例如招聘、房产、结婚等新垂类（大搜导流），主要兼顾SEO、首屏渲染速度。<br>6、小程序(<a target="_blank" rel="noopener" href="https://smartprogram.baidu.com/docs/develop/tutorial/demo/">百度智能小程序</a>)</p>
<p>下面，我按照时间纬度讲述一下上面列的这些不同分化方向的具体项目：</p>
<h3 id="一、重型SPA的MIS"><a href="#一、重型SPA的MIS" class="headerlink" title="一、重型SPA的MIS"></a>一、重型SPA的MIS</h3><p>我是从15年开始入职前端开发的，那一年印象最深的是我配合后端同学开发了10+个内网使用的后台管理系统，这些Mis系统大多是前端框架<a target="_blank" rel="noopener" href="https://www.angular.cn/">Angular1.0</a>和百度出品的前端工程构建工具<a target="_blank" rel="noopener" href="https://github.com/fex-team/fis-plus/wiki">FIS-PLUS</a>配合使用，其中数据图表使用百度出品的<a target="_blank" rel="noopener" href="https://echarts.baidu.com/">Echarts</a>，UI框架使用<a target="_blank" rel="noopener" href="https://getbootstrap.com/">Bootstrap</a>，且多个Mis系统之间使用iframe方案集成到一个叫<a target="_blank" rel="noopener" href="http://www.mkt.nuomi.com/oam#/index">营销门户</a>的主营销Mis系统，该主Mis包括了菜单修改配置、人员权限配置、审批流等公用功能。</p>
<p>FIS-PLUS 是基于 FIS，应用于后端是 PHP，模板是 Smarty 的场景。一般，FISP目录规范如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">site</span><br><span class="line">|____plugin   <span class="comment">// Smarty插件相关，解析*.tpl</span></span><br><span class="line">|       |____compiler.body.php</span><br><span class="line">|       |____compiler.head.php</span><br><span class="line">|       |____compiler.html.php</span><br><span class="line">|       |____compiler.require.php</span><br><span class="line">|       |____compiler.script.php</span><br><span class="line">|       |____compiler.style.php</span><br><span class="line">|       |____compiler.widget.php</span><br><span class="line">|       |____......</span><br><span class="line">|____static <span class="comment">// 静态资源</span></span><br><span class="line">|       |____css</span><br><span class="line">|       |     |____bootstrap <span class="comment">// UI框架</span></span><br><span class="line">|       |     |       |____fonts</span><br><span class="line">|       |     |       |____less</span><br><span class="line">|       |____img </span><br><span class="line">|       |____js</span><br><span class="line">|       |     |____angular.js </span><br><span class="line">|       |     |____echarts.js </span><br><span class="line">|       |     |____mod.js </span><br><span class="line">|       |     |____ui-bootstrap-tpls.js <span class="comment">// bootstrap框架下的UI控件</span></span><br><span class="line">|       |____receiver.php <span class="comment">// 用于推送前端代码到后端开发机联调</span></span><br><span class="line">|____module1</span><br><span class="line">|       |____page</span><br><span class="line">               |____index.tpl <span class="comment">// 入口模板，需后端编译，且依赖Smarty插件解析</span></span><br><span class="line">        |____widget</span><br><span class="line">               |____header</span><br><span class="line">                      |____header.tpl</span><br><span class="line">                      |____header.js</span><br><span class="line">                      |____header.less</span><br><span class="line">               |____banner</span><br><span class="line">                      |____banner.tpl</span><br><span class="line">                      |____banner.js</span><br><span class="line">                      |____banner.less </span><br><span class="line">        |____fis.conf <span class="comment">// fis构建打包配置</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src=""></img></p>
<p>其中重要一点，FIS提供了定位资源能力，可以有效地分离开发路径与部署路径之间的关系：<br><img src=""></img></p>
<p>index.tpl示例如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&#123;%html framework=&quot;oam:static/js/mod.js&quot;%&#125;</span><br><span class="line">&#123;%head%&#125;</span><br><span class="line">    &#123;%block name=&quot;meta&quot;%&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge,chrome=1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://s3.bae.baidu.com/hao123storage/data/oam_16_16_272cfa04e4014981ce736a784176466a&quot;</span>/&gt;</span></span><br><span class="line">    &#123;%/block%&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;%block name=&quot;title&quot;%&#125;营销门户&#123;%/block%&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;%require name=&quot;oam:static/css/bootstrap/less/bootstrap.less&quot;%&#125;</span><br><span class="line">    &#123;%require name=&quot;oam:static/css/common.less&quot;%&#125;</span><br><span class="line">    &#123;%require name=&quot;oam:static/js/angular/angular.js&quot;%&#125;</span><br><span class="line">    &#123;%require name=&quot;oam:static/js/angular-ui-router.js&quot;%&#125;</span><br><span class="line">    &#123;%require name=&quot;oam:static/js/angular/angular-growl.js&quot;%&#125;</span><br><span class="line">    &#123;%require name=&quot;oam:static/js/moment.js&quot;%&#125;</span><br><span class="line">    &#123;%require name=&quot;oam:static/js/ui-bootstrap-tpls-0.12.0.js&quot;%&#125;</span><br><span class="line">    &#123;%require name=&quot;oam:static/js/echarts-all.js&quot;%&#125;</span><br><span class="line">&#123;%/head%&#125;</span><br><span class="line">&#123;%body%&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">growl</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">page-header</span>&gt;</span><span class="tag">&lt;/<span class="name">page-header</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-2 col-sm-2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sidebar</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sidebar</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-10 col-sm-10 pageBody&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">height</span>=<span class="string">&#x27;3000px&#x27;</span> <span class="attr">width</span>=<span class="string">&#x27;1058px&#x27;</span> <span class="attr">ng-show</span>=<span class="string">&#x27;iframeUrl&#x27;</span> <span class="attr">ng-src</span>=<span class="string">&quot;&#123;&#123;iframeUrl|trustAsResourceUrl&#125;&#125;&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">id</span>=<span class="string">&quot;framePage&quot;</span> <span class="attr">scrolling</span>=<span class="string">&quot;auto&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-hide</span>=<span class="string">&#x27;iframeUrl&#x27;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">ui-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;%block name=&quot;body&quot;%&#125;</span><br><span class="line">    &#123;%script%&#125;</span><br><span class="line">        require.async([&quot;oam:widget/init/init.js&quot;],function()&#123;</span><br><span class="line">            angular.element(document).ready(function() &#123;</span><br><span class="line">            angular.module(&#x27;oamApp&#x27;, [&#x27;oamMod&#x27;]);</span><br><span class="line">                angular.bootstrap(document, [&#x27;oamApp&#x27;]);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#123;%/script%&#125;</span><br><span class="line">&#123;%/block%&#125;</span><br><span class="line">&#123;%/body%&#125;</span><br><span class="line">&#123;%/html%&#125;</span><br></pre></td></tr></table></figure>

<p>重型的SPA页面，业务功能复杂，使用Vue，React，Angular这种MVVM的框架，在开发过程中，很多懒加载和延迟加载之类的也是不需要做。因为相关的数据后面都需要用到，也就不存在是否会使用的问题。</p>
<h3 id="二、Hybrid做糯米APP"><a href="#二、Hybrid做糯米APP" class="headerlink" title="二、Hybrid做糯米APP"></a>二、Hybrid做糯米APP</h3><p>16年至17年接触<a target="_blank" rel="noopener" href="https://m.nuomi.com/">糯米APP</a>的组件开发，采用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/yexiaochai/p/4921635.html">Hybrid</a> 解决方案<a target="_blank" rel="noopener" href="http://developer.nuomi.com/#/home">百度Hybrid开放平台</a>达到跨平台支持、贴近原生的用户体验，这里大部分糯米组件(例如附近页、积分商城、我的)主要是利用前端框架<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/">Vue.js</a>其天然支持组件化的特性来支持前端同学组件化开发，Ajax异步接口调用，达到多个前端内部高度分治，前后端分离的目的；</p>
<p>简单来说，组件包是基于业务开发的一系列组件化页面的集合,是用于组织某个业务功能所涉及的H5页面的单位。组件包是由至少1个H5页面和一个config.json配置文件的页面集合压缩而成。<br>百度组件化技术是一种Hybrid开发技术，主要有以下特点：</p>
<ol>
<li>用基于Webview的H5页面取代原生页面</li>
<li>为组件提供一套统一的调用Native能力的API,消除平台差异 — BNJS</li>
<li>以组件为单位管理h5页面<br>组件包id（示例名为demo）唯一，需在百度Hybrid开放平台申请注册。组件包内每个页面需包含一个配置文件config.json，配置名称和是否登录，图标icon以及接口是否预加载等：</li>
</ol>
<p><img src=""></img></p>
<p style="margin-left:400px;">Hybrid开放平台</p>

<p>一份完整的配置文件config.json范例如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;demo&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.3&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pages&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;file&quot;</span>: <span class="string">&quot;/page/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;login&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">&quot;prehttp&quot;</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;url&quot;</span>:<span class="string">&quot;http://app.nuomi.com/naserver/search/searchitem&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;action&quot;</span>:<span class="string">&quot;postNA&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;params&quot;</span>:&#123;</span><br><span class="line">              <span class="attr">&quot;page_idx&quot;</span>:<span class="number">0</span>,</span><br><span class="line">              <span class="attr">&quot;goods_per_page&quot;</span>:<span class="number">15</span>,</span><br><span class="line">              <span class="attr">&quot;locate_city_id&quot;</span>:<span class="string">&quot;$&#123;location.cityCode&#125;&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;page_type&quot;</span>:<span class="string">&quot;component&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;logpage&quot;</span>:<span class="string">&quot;SearchList&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;sidlist&quot;</span>:<span class="string">&quot;$&#123;env.sidList&#125;&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;sort_type&quot;</span>:<span class="number">0</span>,</span><br><span class="line">              <span class="attr">&quot;keywords&quot;</span>:<span class="string">&quot;$&#123;keyword&#125;&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;s_brother&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;backupList&quot;</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;file&quot;</span>: <span class="string">&quot;/page/user.html&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;login&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;tpl&quot;</span>: <span class="string">&quot;nuomi&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;domainlist&quot;</span>: [<span class="string">&quot;app.nuomi.com&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;webp_proxy&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;enable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">&quot;include&quot;</span>: [],</span><br><span class="line">      <span class="attr">&quot;exclude&quot;</span>: []</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;resources&quot;</span>:[</span><br><span class="line">      <span class="string">&quot;__BNJSComPackage/js/zepto/1.1.6/zepto.min.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;__BNJSComPackage/cs/animate/3.5.0/animate.min.css&quot;</span>,</span><br><span class="line">      <span class="string">&quot;__BNJSComPackage/img/loading_1/1.0.0/loading_1.png&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;canPreload&quot;</span>: <span class="number">1</span>,  </span><br><span class="line">  <span class="attr">&quot;https&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;op.juhe.cn&quot;</span>,</span><br><span class="line">      <span class="string">&quot;app.nuomi.com&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;public_resource&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;enable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">&quot;enable_comps&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;index&quot;</span></span><br><span class="line">      ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;default_ua&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>组件包的生命周期如下图：<br><img src="">Hybrid开放平台</p></p>
<p>而H5页面一般可以用vue、react等框架基础上开发：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首页</span></span><br><span class="line"><span class="keyword">import</span> VueComponentApp <span class="keyword">from</span> <span class="string">&#x27;./index.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Pages <span class="keyword">from</span> <span class="string">&#x27;../config/page.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line">BNJSReady(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    BNJS.ui.title.setTitle(<span class="string">&#x27;我的积分商城&#x27;</span>);</span><br><span class="line">    BNJS.ui.title.addActionButton(&#123;</span><br><span class="line">        tag: <span class="string">&#x27;23&#x27;</span>,</span><br><span class="line">        text: <span class="string">&#x27;积分解读&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="title">callback</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            BNJS.statistic.addLog(&#123;</span><br><span class="line">                actionID: <span class="string">&#x27;Points_Rules&#x27;</span>,</span><br><span class="line">                actionExt: <span class="string">&#x27;积分_积分规则点击量&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">            BNJS.page.start(Pages.points_rules);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="title">render</span>(<span class="params">h</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> h(VueComponentApp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    BNJS.ui.hideLoadingPage();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="三、H5输出平台"><a href="#三、H5输出平台" class="headerlink" title="三、H5输出平台"></a>三、H5输出平台</h3><p>17年由于各个产品线运营同学对产品营销推广的庞大需求，例如H5页面促销活动（3.7女生节、5.7吃货节，摇一摇，秒杀）、落地推广、商业广告变现等需求，急需推出一个针对糯米全网甚至全厂的、满足运营同学能随时随地配置并输出活动页面的平台，<a target="_blank" rel="noopener" href="http://omg.int.nuomi.com/">活动运营配置平台</a>在这种情况下应运而生，极大地促进了前端同学的人力成本降为10%，截至目前该平台已输出活动5000+，该平台采用多种技术框架(Vue.js开发平台组件、React.js开发平台操作性功能、各种中间件)揉和在一起，主要<span style="color:red">技术难点</span>在于平台组件(促销组件：例如刮刮乐、老虎机、九宫格、弹幕、优惠券等，功能组件：例如轮播图、表单、TAB切换、城市定位等)可拖拽拼合成页面、独立组件关联、多团单页面性能、页面实时预览、人员权限分配管理等。</p>
<p><img src=""></img></p>
<p style="margin-left:400px;">活动配置平台-可拖拽配置Demo</p>

<p>用户在平台上通过配置多个组件拼装活动内容会生成对应js和css文件的cdn地址(<code>cdnJsUrl</code>、<code>cdnCssUrl</code>)，并和当前的活动id(<code>ac_id</code>)绑定。</p>
<p>用户配置完活动可以先预览效果，预览URL示例：<code>http://****/cplatform/wap/mkt?is_preview=1&amp;cdnJsUrl=https://nmhdbos.nuomi.com/1548-1551932374-181466643-cdnJsUrl.js&amp;cdnCssUrl=https://nmhdbos.nuomi.com/1548-1551932374-181466643-cdnCssUrl.css&amp;ac_id=1548</code><br><img src=""></img></p>
<p style="margin-left:100px;">活动配置平台-大体框架图</p>

<p>1.NA上mkt-framework组件（baidu/tuan-mkt-bc/mkt-framework）</p>
<p>这个是活动在na上运行的框架，它只是个壳的作用，内容的渲染是：会根据url的参数活动id（ac_id）去请求后端接口，拿到页面配置的元素生成的js、css文件的cdn地址，加载并运行，另外一种是参数上直接带cdn地址（如上的预览示例URL），如下index.js。</p>
<p>这里采用上一节讲到的配置文件config.json，采用预加载方式提高页面加载速度：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:   <span class="string">&quot;framework_index&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;login&quot;</span>:  <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;prehttp&quot;</span>:[&#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>:<span class="string">&quot;https://huodong.nuomi.com/acplat/data/acbasic&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;action&quot;</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;params&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;ac_id&quot;</span>:<span class="string">&quot;$&#123;ac_id&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这个壳index.html如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>百度糯米<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;format-detection&quot;</span> <span class="attr">content</span>=<span class="string">&quot;telephone=no&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge,chrome=1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">compid</span>=<span class="string">&quot;noComp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">&quot;page-loading&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;waite-loading&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="symbol">&amp;nbsp;</span>加载中...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-wrapper&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.js主要逻辑截取如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">BNJSReady(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    BNJS.ui.hideLoadingPage();</span><br><span class="line">    BNJS.page.getData(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> params = res;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果是单组件na或wap预览</span></span><br><span class="line">        <span class="keyword">if</span>(params.cdnJsUrl &amp;&amp; params.cdnCssUrl)&#123;</span><br><span class="line">            BNJS.ui.title.setTitle(<span class="string">&#x27;单组件预览&#x27;</span>);</span><br><span class="line">            MKT.loadCss(params.cdnCssUrl,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                BNJS.ui.showTips(<span class="string">&#x27;页面样式加载失败&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            .loadJs(params.cdnJsUrl, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app-wrapper&#x27;</span>).style.visibility = <span class="string">&#x27;visible&#x27;</span>;</span><br><span class="line">                <span class="keyword">var</span> $loading = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;page-loading&#x27;</span>);</span><br><span class="line">                $loading &amp;&amp; ($loading.style.display = <span class="string">&#x27;none&#x27;</span>);</span><br><span class="line">            &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                BNJS.ui.showTips(<span class="string">&#x27;页面脚本加载失败&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        MKT.acid = params.ac_id || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        MKT.tsmcid = params.tsmcid || <span class="string">`mkt_<span class="subst">$&#123;params.ac_id&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发起统计</span></span><br><span class="line">        handleBaiduidAndSendPv(<span class="string">`mkt_<span class="subst">$&#123;params.ac_id&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果是wap环境则在发布后静态文件是后端渲染到页面上</span></span><br><span class="line">        <span class="comment">// 在预览环境则是url上直接传js和css的cdn地址</span></span><br><span class="line">        <span class="keyword">if</span> (BNJS.env.appName === <span class="string">&quot;bainuo-wap&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">// 设置异常情况下页面展现</span></span><br><span class="line">            <span class="keyword">switch</span> (+MKT_CONF.status) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    BNJS.ui.showTips(<span class="string">&#x27;活动已下线&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    BNJS.ui.showTips(<span class="string">&#x27;活动未开始&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    BNJS.ui.showTips(<span class="string">&#x27;活动结束&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app-wrapper&#x27;</span>).style.visibility = <span class="string">&#x27;visible&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 糯米NA上的处理逻辑</span></span><br><span class="line">        <span class="comment">//请求参数</span></span><br><span class="line">        <span class="keyword">var</span> reqParam = &#123;&#125;;</span><br><span class="line">        params.ac_id &amp;&amp; (reqParam.ac_id = params.ac_id);</span><br><span class="line">        params.is_preview &amp;&amp; (reqParam.is_preview = params.is_preview);</span><br><span class="line">        BNJS.http.post(&#123;</span><br><span class="line">            url: config.getActConfig,</span><br><span class="line">            params: reqParam,</span><br><span class="line">            onSuccess: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (res.errno == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> data = res.data;</span><br><span class="line">                    <span class="comment">// 设置活动标题</span></span><br><span class="line">                    BNJS.ui.title.setTitle(data.ac_title);</span><br><span class="line">                    <span class="comment">// 加载组件列表</span></span><br><span class="line">                    <span class="keyword">if</span> (params.is_preview == <span class="number">1</span> || data.status == <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">var</span> staticInfo;</span><br><span class="line">                        <span class="keyword">try</span>&#123;</span><br><span class="line">                            staticInfo = <span class="built_in">JSON</span>.parse(data.static_info);</span><br><span class="line">                        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">                            BNJS.ui.showTips(<span class="string">&#x27;页面解析错误&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (staticInfo &amp;&amp; staticInfo.cdnCssUrl &amp;&amp; staticInfo.cdnJsUrl) &#123;</span><br><span class="line">                             MKT.loadCss(staticInfo.cdnCssUrl,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                             &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                                BNJS.ui.showTips(<span class="string">&#x27;页面样式加载失败&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">                             &#125;)</span><br><span class="line">                             .loadJs(staticInfo.cdnJsUrl, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                                <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app-wrapper&#x27;</span>).style.visibility = <span class="string">&#x27;visible&#x27;</span>;</span><br><span class="line">                                <span class="built_in">document</span>.getElementById(<span class="string">&#x27;page-loading&#x27;</span>).style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">&#x27;获取脚本距页面初始化时间：&#x27;</span>);</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="built_in">Date</span>.now()-startTime);</span><br><span class="line">                            &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                                BNJS.ui.showTips(<span class="string">&#x27;页面脚本加载失败&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            BNJS.ui.showTips(<span class="string">&#x27;页面内容加载失败&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// ...</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>2.wap的实现：<br>wap的基本原理和NA上是一致的，通过把组件的html、js、css文件放到对应的后端环境下，分为平台预览环境和线上环境。这种首先的问题是解决bnjs接口跨域的问题。</p>
<p>3.BNJS改造：<br>因为BNJS一些数据的初始化是通过请求m.nuomi.com实现的，如account、location等。如果平台上直接使用的话会存在跨域问题，所以解决办法就有：<br>1）运营这边rd支持这些接口<br>2）让m.nuomi.com支持从运营平台这边（huodong.nuomi.com）的跨域请求<br>3）前端重新开发一套BNJS，避免去请求那些会跨域的接口<br>最后基于可靠、功能、时间成本选择了方案2</p>
<p>4.预览环境<br>分为前端：baidu/tuan-mkt-bc/custom-mkt-web，后端（Node.js+KOA.js，也是fe同学负责）：baidu/tuan-mkt-bc/custom-mkt-server，最后接口API和数据库表由运营rd同学负责。</p>
<p>将组件的index.html、index.js、base.js、index.css和BNJS分别放到后端代码对应的位置，然后添加个路由（wap/preview）渲染这个模板即可。<br>待解决的问题是预览环境的域不是huodong.nuomi.com，m.nuomi.com还不支持跨域，可以先通过挂代理的方式去做</p>
<p>5.线上环境<br>线上模块是baidu/tuan-fe-bj-b/sas-acttpl（FIS-Plus支持），通过把组件的静态文件放到对应的目录里，让rd配置访问的路由。因为这个项目模板是由smarty渲染，所以上面1提到的壳index.html需要修改成smarty模板（index.tpl），同时可以把内容区域渲染的cdn文件地址等数据让rd动态渲染到页面里面。</p>
<p>index.tpl示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&#123;%html%&#125;</span><br><span class="line">    &#123;%head%&#125;</span><br><span class="line">        &lt;meta charset&#x3D;&quot;utf-8&quot;&#x2F;&gt;</span><br><span class="line">        &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;</span><br><span class="line">        &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;initial-scale&#x3D;1.0, maximum-scale&#x3D;1.0, user-scalable&#x3D;no, width&#x3D;device-width&quot; &#x2F;&gt;</span><br><span class="line">        &#123;%block name&#x3D;&quot;seo&quot;%&#125;</span><br><span class="line">            &lt;meta name&#x3D;&quot;keywords&quot; content&#x3D;&quot;&#123;%$data.keywords|default:&#39;百度糯米&#39;%&#125;&quot; &#x2F;&gt;</span><br><span class="line">            &lt;title&gt;&#123;%$data.ac_title|default:&#39;百度糯米&#39;%&#125;&lt;&#x2F;title&gt;</span><br><span class="line">        &#123;%&#x2F;block%&#125;</span><br><span class="line">        &lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class="line">            body &#123;</span><br><span class="line">                opacity:0</span><br><span class="line">            &#125;</span><br><span class="line">            .BNJS-body-with-loading &#123;</span><br><span class="line">                position: relative;</span><br><span class="line">                width: 100%;</span><br><span class="line">                height: 100%;</span><br><span class="line">                background-color: #EEE</span><br><span class="line">            &#125;</span><br><span class="line">        &lt;&#x2F;style&gt;</span><br><span class="line">        &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;&#123;%$data.static_info.cdnCssUrl%&#125;&quot;&gt;</span><br><span class="line">        &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;&#x2F;static&#x2F;css&#x2F;mkt-index.css&quot;&gt;        </span><br><span class="line">        &lt;script&gt;     	</span><br><span class="line">            var MKT_CONF &#x3D; &#123;</span><br><span class="line">                title: &#39;&#123;%$data.ac_title|escape:javascript%&#125;&#39;, </span><br><span class="line">                shareImg: &#39;&#123;%$data.share_descpic_url|escape:javascript%&#125;&#39;,</span><br><span class="line">                shareDesc: &#39;&#123;%$data.share_desc|escape:javascript%&#125;&#39;,</span><br><span class="line">                shareTitle: &#39;&#123;%$data.share_title|escape:javascript%&#125;&#39; || &#39;&#123;%$data.ac_title|escape:javascript%&#125;&#39;,</span><br><span class="line">                desc: &#39;&#123;%$data.ac_desc|escape:javascript%&#125;&#39;,</span><br><span class="line">                actId: &#39;&#123;%$data.id|escape:javascript%&#125;&#39;,</span><br><span class="line">                status: &#39;&#123;%$data.status|escape:javascript%&#125;&#39;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#123;%*手百分享配置*%&#125;</span><br><span class="line">            var BoxShareData &#x3D; &#123;</span><br><span class="line">                &quot;successcallback&quot;: &quot;bdboxSuccess&quot;,</span><br><span class="line">                &quot;errorcallback&quot;: &quot;bdboxError&quot;,</span><br><span class="line">                &quot;options&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;: &quot;url&quot;,</span><br><span class="line">                    &quot;mediaType&quot;: &quot;all&quot;,</span><br><span class="line">                    &quot;linkUrl&quot;: location.href,</span><br><span class="line">                    &quot;title&quot;: &#39;&#123;%$data.share_title|escape:javascript%&#125;&#39; || &#39;&#123;%$data.ac_title|escape:javascript%&#125;&#39;,</span><br><span class="line">                    &quot;content&quot;: &#39;&#123;%$data.share_desc|escape:javascript%&#125;&#39;,</span><br><span class="line">                    &quot;iconUrl&quot;: &#39;&#123;%$data.share_descpic_url|escape:javascript%&#125;&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#123;%*bnjs运行依赖的数据，正常是由后端注入到页面中，暂时写死*%&#125;</span><br><span class="line">            window.pageInfo &#x3D; &#123;</span><br><span class="line">                &quot;account&quot;:&#123;</span><br><span class="line">                    &quot;uid&quot;:null,</span><br><span class="line">                    &quot;uname&quot;:null,</span><br><span class="line">                    &quot;displayname&quot;:null,</span><br><span class="line">                    &quot;encrypt_phone&quot;:null,</span><br><span class="line">                    &quot;bduss&quot;:&quot;BDUSS&quot;,</span><br><span class="line">                    &quot;pass_portrait&quot;:&quot;&quot;,</span><br><span class="line">                    &quot;nuomi_portrait&quot;:&quot;&quot;,</span><br><span class="line">                    &quot;nuomi_nickname&quot;:&quot;&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;city&quot;:&#123;</span><br><span class="line">                    &quot;cityCode&quot;:&quot;&quot;,</span><br><span class="line">                    &quot;cityName&quot;:&quot;&quot;,</span><br><span class="line">                    &quot;shortCityName&quot;:&quot;&quot;,</span><br><span class="line">                    &quot;cityUrl&quot;:&quot;&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;component&quot;:&#123;</span><br><span class="line">                    &quot;id&quot;:&quot;mkt-component&quot;,</span><br><span class="line">                    &quot;version&quot;:&quot;1.0.5&quot;,</span><br><span class="line">                    &quot;pages&quot;:[</span><br><span class="line">                        &#123;&quot;name&quot;:&quot;framework_index&quot;,&quot;file&quot;:&quot;&#x2F;mkt-framework&#x2F;index&#x2F;index.html&quot;,&quot;login&quot;:false&#125;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;https&quot;:[&quot;se.nuomi.com&quot;],</span><br><span class="line">                    &quot;currentPage&quot;:&quot;mkt-framework&#x2F;index&#x2F;index.html&quot;,</span><br><span class="line">                    &quot;sid&quot;: &quot;&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;site&quot;:&#123;</span><br><span class="line">                    &quot;prefix&quot;:&quot;https:&#x2F;&#x2F;m.nuomi.com&#x2F;component&#x2F;mkt-framework&#x2F;1.0.5&quot;,</span><br><span class="line">                    &quot;config&quot;:&#123;</span><br><span class="line">                        &quot;city-select&quot;:false,</span><br><span class="line">                        &quot;title&quot;:false,</span><br><span class="line">                        &quot;force-redirect&quot;:true,</span><br><span class="line">                        &quot;home-button&quot;:false,</span><br><span class="line">                        &quot;no-share-icon&quot;:false,</span><br><span class="line">                        &quot;on-open-fail&quot;:&quot;redirect&quot;,</span><br><span class="line">                        &quot;theme&quot;:&quot;wap&quot;,</span><br><span class="line">                        &quot;home-button-url&quot;:&quot;http:&#x2F;&#x2F;m.nuomi.com&quot;,</span><br><span class="line">                        &quot;hijack-link-click&quot;:&quot;false&quot;,</span><br><span class="line">                        &quot;broadcast-notice-in-weixin&quot;:&quot;false&quot;,</span><br><span class="line">                        &quot;redirect-map&quot;:&quot;&quot;,</span><br><span class="line">                        &quot;getData&quot;:[]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;currentPage&quot;:&quot;framework_index&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;customUi&quot;:[],</span><br><span class="line">                &quot;env&quot;:&#123;</span><br><span class="line">                    &quot;payHost&quot;:&quot;https:&#x2F;&#x2F;zhifu.baidu.com&quot;,</span><br><span class="line">                    &quot;requestUrl&quot;:&quot;&#x2F;&#x2F;m.nuomi.com&#x2F;webapp&#x2F;bnjs&#x2F;request&quot;,</span><br><span class="line">                    &quot;naserverHost&quot;:&quot;&#x2F;&#x2F;app.nuomi.com&quot;,</span><br><span class="line">                    &quot;loginHost&quot;:&quot;https:&#x2F;&#x2F;wappass.baidu.com&quot;,</span><br><span class="line">                    &quot;userInfoBaiduHost&quot;:&quot;&#x2F;&#x2F;nuomiwappassport.baidu.com&quot;,</span><br><span class="line">                    &quot;rootUrl&quot;:&quot;https:&#x2F;&#x2F;devers.baidu.com&#x2F;cdn&#x2F;static&#x2F;comp_to_wap&#x2F;carsales&#x2F;2.0.6&quot;,</span><br><span class="line">                    &quot;network&quot;:&quot;1&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;schema&quot;:&#123;</span><br><span class="line">                    &quot;tuandetail&quot;:&quot;http:&#x2F;&#x2F;m.nuomi.com&#x2F;webapp&#x2F;tuan&#x2F;detail?deal_id&#x3D;$&#123;tuanid&#125;&quot;,</span><br><span class="line">                    &quot;search&quot;:&quot;http:&#x2F;&#x2F;m.nuomi.com&#x2F;webapp&#x2F;tuan&#x2F;search&quot;,</span><br><span class="line">                    &quot;merchantmap&quot;:&quot;http:&#x2F;&#x2F;m.nuomi.com&#x2F;webapp&#x2F;tuan&#x2F;shopmap?merchantId&#x3D;$&#123;shopid&#125;$&#123;seller_id&#125;&quot;,</span><br><span class="line">                    &quot;categorylist&quot;:&quot;http:&#x2F;&#x2F;m.nuomi.com&#x2F;$&#123;category&#125;&#x2F;0-0&#x2F;0-0-0-0-0-0&#x2F;0-0&quot;,</span><br><span class="line">                    &quot;searchresult&quot;:&quot;http:&#x2F;&#x2F;m.nuomi.com&#x2F;webapp&#x2F;tuan&#x2F;list?$&#123;keyword&#125;&quot;,</span><br><span class="line">                    &quot;t10comp&quot;:&quot;&#x2F;&#x2F;m.nuomi.com&#x2F;component?compid&#x3D;$&#123;compid&#125;&amp;comppage&#x3D;$&#123;comppage&#125;&quot;,</span><br><span class="line">                    &quot;panorama&quot;:&quot;&#x2F;&#x2F;m.nuomi.com&#x2F;component?compid&#x3D;wap-widget&amp;comppage&#x3D;panorama&amp;uid&#x3D;$&#123;uid&#125;&quot;,</span><br><span class="line">                    &quot;commentlist&quot;:&quot;http:&#x2F;&#x2F;m.nuomi.com&#x2F;webapp&#x2F;tuan&#x2F;comment?deal_id&#x3D;$&#123;tuanid&#125;&quot;,</span><br><span class="line">                    &quot;home&quot;:&quot;&#x2F;&#x2F;m.nuomi.com&quot;,</span><br><span class="line">                    &quot;searchresultcomp&quot;:&quot;&#x2F;&#x2F;m.nuomi.com&#x2F;component?compid&#x3D;$&#123;compid&#125;&amp;comppage&#x3D;$&#123;comppage&#125;&amp;keyword&#x3D;$&#123;keyword&#125;&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;getData&quot;:&quot;&quot;</span><br><span class="line">            &#125;;</span><br><span class="line">        &lt;&#x2F;script&gt;</span><br><span class="line">        &#123;%block name&#x3D;&quot;head&quot;%&#125;&#123;%&#x2F;block%&#125;</span><br><span class="line">    &#123;%&#x2F;head%&#125;</span><br><span class="line"></span><br><span class="line">    &#123;%body%&#125;</span><br><span class="line">        &#123;%block name&#x3D;&quot;content&quot;%&#125;</span><br><span class="line">            &lt;div id&#x3D;app-wrapper&gt;</span><br><span class="line">                &lt;section id&#x3D;app&gt;&lt;&#x2F;section&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;section id&#x3D;&quot;page-error&quot;&gt;</span><br><span class="line">                &lt;p class&#x3D;&quot;error-text&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;p class&#x3D;&quot;error-refresh-bnt&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line">            &lt;&#x2F;section&gt;</span><br><span class="line"></span><br><span class="line">        &#123;%&#x2F;block%&#125;	</span><br><span class="line"></span><br><span class="line">        &#123;%if $data.id &#x3D;&#x3D; 324 || $data.id &#x3D;&#x3D; 451 %&#125;</span><br><span class="line">            &lt;script src&#x3D;&quot;&#x2F;static&#x2F;js&#x2F;BNJS.without.location.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">        &#123;%else%&#125;</span><br><span class="line">            &lt;script src&#x3D;&quot;&#x2F;static&#x2F;js&#x2F;BNJS.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">        &#123;%&#x2F;if%&#125;</span><br><span class="line"></span><br><span class="line">        &lt;script src&#x3D;&quot;&#x2F;static&#x2F;js&#x2F;mkt-base.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;&#x2F;static&#x2F;js&#x2F;mkt-index.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;&#x2F;static&#x2F;js&#x2F;aio.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;&#123;%$data.static_info.cdnJsUrl%&#125;&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;&#x2F;&#x2F;res.wx.qq.com&#x2F;open&#x2F;js&#x2F;jweixin-1.0.0.js&quot;&gt;&lt;&#x2F;script&gt;		</span><br><span class="line">    &#123;%&#x2F;body%&#125;</span><br><span class="line">&#123;%&#x2F;html%&#125;</span><br></pre></td></tr></table></figure>

<h3 id="四、Node做服务端渲染，前后端同构"><a href="#四、Node做服务端渲染，前后端同构" class="headerlink" title="四、Node做服务端渲染，前后端同构"></a>四、Node做服务端渲染，前后端同构</h3><p>18年初，我们组高工采用<a target="_blank" rel="noopener" href="https://ssr.vuejs.org/zh/guide/">Vue-SSR</a>的SSR(服务端渲染)技术方案，搭建了一套基于Vue.js + Node.js + Koa.js(服务框架) + Webpack(前端构建)的SSR框架。这套框架适用于招聘、房产、结婚等新垂类，使用的好处是既能用我们前端组同学熟悉的技术栈、快速开发上线，又能兼顾SEO、首屏渲染速度快，但是最大缺点是对机器部署有要求(要求机器实例能部署Node.js框架)。</p>
<p><img src=""></img></p>
<p style="margin-left:100px;">Node做服务端渲染的优缺点</p>

<p>目录规范如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">├── components</span><br><span class="line">│   ├── Item.vue</span><br><span class="line">│   ├── Home.vue</span><br><span class="line">│   └── 404.vue</span><br><span class="line">├── App.vue</span><br><span class="line">├── app.js # 通用 entry(universal entry)</span><br><span class="line">├── entry-client.js # 仅运行于浏览器</span><br><span class="line">└── entry-server.js # 仅运行于服务器</span><br><span class="line">└── router.js # 路由</span><br><span class="line">└── store.js </span><br></pre></td></tr></table></figure>

<p>对于客户端应用程序和服务器应用程序，我们都要使用 webpack 打包 - 服务器需要「服务器 bundle」然后用于服务器端渲染(SSR)，而「客户端 bundle」会发送给浏览器，用于混合静态标记。<br><img src=""></img></p>
<p style="margin-left:400px;">vue-ssr实现原理图</p>

<p>入口模板App.vue 模板中根元素具有 <code>id=&quot;app&quot;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>由于在Node中创建多个相同服务进程会造成很大资源浪费，故此暴露一个可以重复执行的工厂函数，为每个请求创建新的应用程序实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; sync &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex-router-sync&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 创建 router 和 store 实例</span></span><br><span class="line">  <span class="keyword">const</span> router = createRouter()</span><br><span class="line">  <span class="keyword">const</span> store = createStore()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 同步路由状态(route state)到 store</span></span><br><span class="line">  sync(store, router)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建应用程序实例，将 router 和 store 注入</span></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    store,</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 暴露 app, router 和 store。</span></span><br><span class="line">  <span class="keyword">return</span> &#123; app, router, store &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在客户端进行数据预取：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-client.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;./app&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; app, router, store &#125; = createApp()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__INITIAL_STATE__) &#123;</span><br><span class="line">  store.replaceState(<span class="built_in">window</span>.__INITIAL_STATE__)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.onReady(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 添加路由钩子函数，用于处理 asyncData.</span></span><br><span class="line">  <span class="comment">// 在初始路由 resolve 后执行，</span></span><br><span class="line">  <span class="comment">// 以便我们不会二次预取(double-fetch)已有的数据。</span></span><br><span class="line">  <span class="comment">// 使用 `router.beforeResolve()`，以便确保所有异步组件都 resolve。</span></span><br><span class="line">  router.beforeResolve(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> matched = router.getMatchedComponents(to)</span><br><span class="line">    <span class="keyword">const</span> prevMatched = router.getMatchedComponents(<span class="keyword">from</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 我们只关心非预渲染的组件</span></span><br><span class="line">    <span class="comment">// 所以我们对比它们，找出两个匹配列表的差异组件</span></span><br><span class="line">    <span class="keyword">let</span> diffed = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">const</span> activated = matched.filter(<span class="function">(<span class="params">c, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> diffed || (diffed = (prevMatched[i] !== c))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!activated.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> next()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里如果有加载指示器 (loading indicator)，就触发</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Promise</span>.all(activated.map(<span class="function"><span class="params">c</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (c.asyncData) &#123;</span><br><span class="line">        <span class="keyword">return</span> c.asyncData(&#123; store, <span class="attr">route</span>: to &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 停止加载指示器(loading indicator)</span></span><br><span class="line"></span><br><span class="line">      next()</span><br><span class="line">    &#125;).catch(next)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  app.$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在服务器端进行数据预取：<br>在 entry-server.js 中，我们可以通过路由获得与 router.getMatchedComponents() 相匹配的组件，如果组件暴露出 asyncData，我们就调用这个方法。然后我们需要将解析完成的状态，附加到渲染上下文(render context)中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;./app&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> context =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; app, router, store &#125; = createApp()</span><br><span class="line"></span><br><span class="line">    router.push(context.url)</span><br><span class="line"></span><br><span class="line">    router.onReady(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> matchedComponents = router.getMatchedComponents()</span><br><span class="line">      <span class="keyword">if</span> (!matchedComponents.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject(&#123; <span class="attr">code</span>: <span class="number">404</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 对所有匹配的路由组件调用 `asyncData()`</span></span><br><span class="line">      <span class="built_in">Promise</span>.all(matchedComponents.map(<span class="function"><span class="params">Component</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Component.asyncData) &#123;</span><br><span class="line">          <span class="keyword">return</span> Component.asyncData(&#123;</span><br><span class="line">            store,</span><br><span class="line">            route: router.currentRoute</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 在所有预取钩子(preFetch hook) resolve 后，</span></span><br><span class="line">        <span class="comment">// 我们的 store 现在已经填充入渲染应用程序所需的状态。</span></span><br><span class="line">        <span class="comment">// 当我们将状态附加到上下文，</span></span><br><span class="line">        <span class="comment">// 并且 `template` 选项用于 renderer 时，</span></span><br><span class="line">        <span class="comment">// 状态将自动序列化为 `window.__INITIAL_STATE__`，并注入 HTML。</span></span><br><span class="line">        context.state = store.state</span><br><span class="line"></span><br><span class="line">        resolve(app)</span><br><span class="line">      &#125;).catch(reject)</span><br><span class="line">    &#125;, reject)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异步路由组件的路由配置示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createRouter</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">    mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">    routes: [</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./components/Home.vue&#x27;</span>) &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;/item/:id&#x27;</span>, <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./components/Item.vue&#x27;</span>) &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用官方状态管理库 Vuex。根据 id 获取 item 的逻辑demo如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假定我们有一个可以返回 Promise 的</span></span><br><span class="line"><span class="comment">// 通用 API（请忽略此 API 具体实现细节）</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchItem &#125; <span class="keyword">from</span> <span class="string">&#x27;./api&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">      items: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">      fetchItem (&#123; commit &#125;, id) &#123;</span><br><span class="line">        <span class="comment">// `store.dispatch()` 会返回 Promise，</span></span><br><span class="line">        <span class="comment">// 以便我们能够知道数据在何时更新</span></span><br><span class="line">        <span class="keyword">return</span> fetchItem(id).then(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          commit(<span class="string">&#x27;setItem&#x27;</span>, &#123; id, item &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">      setItem (state, &#123; id, item &#125;) &#123;</span><br><span class="line">        Vue.set(state.items, id, item)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要通过访问路由，来决定获取哪部分数据 - 这也决定了哪些组件需要渲染。在路由组件上暴露出一个自定义静态函数 <code>asyncData</code>，进行<code>数据预取</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Item.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123; item.title &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  asyncData (&#123; store, route &#125;) &#123;</span><br><span class="line">    <span class="comment">// 触发 action 后，会返回 Promise</span></span><br><span class="line">    <span class="keyword">return</span> store.dispatch(<span class="string">&#x27;fetchItem&#x27;</span>, route.params.id)</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">// 从 store 的 state 对象中的获取 item。</span></span><br><span class="line">    item () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.items[<span class="built_in">this</span>.$route.params.id]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>与服务器集成：<br>在Node.js中使用Koa.js(web 框架)，Koa通过利用 async 函数，Koa 帮你丢弃回调函数，并有力地增强错误处理。如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--/views/layout.html--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>百度糯米<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--vue-ssr-outlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用vue-server-renderer插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> LRU <span class="keyword">from</span> <span class="string">&#x27;lru-cache&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createBundleRenderer&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-server-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverBundle = <span class="built_in">require</span>(<span class="string">&#x27;../vue-ssr-server-bundle.json&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> clientManifest = <span class="built_in">require</span>(<span class="string">&#x27;../vue-ssr-client-manifest.json&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> template = fs.readFileSync(resolve(__dirname, <span class="string">&#x27;../../views/layout.html&#x27;</span>), <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> renderer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createRenderer</span> (<span class="params">bundle, options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createBundleRenderer(bundle, <span class="built_in">Object</span>.assign(options, &#123;</span><br><span class="line">            template,</span><br><span class="line">            inject: <span class="literal">true</span>,</span><br><span class="line">            runInNewContext: <span class="literal">false</span>,</span><br><span class="line">            cache: LRU(&#123;</span><br><span class="line">                max: <span class="number">1000</span>,</span><br><span class="line">                <span class="comment">// 15min</span></span><br><span class="line">                maxAge: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">15</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    renderer = createRenderer(serverBundle, &#123;</span><br><span class="line">        clientManifest</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> context = &#123;</span><br><span class="line">            url: ctx.req.url,</span><br><span class="line">            locals: ctx.locals,</span><br><span class="line">            cookie: ctx.req.headers.cookie</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            renderer.renderToString(context, <span class="function">(<span class="params">err, html</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    reject(err);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    resolve(html);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ctx.body = <span class="keyword">await</span> promise;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err.url) &#123;</span><br><span class="line">                ctx.redirect(err.url);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (err.code === <span class="number">404</span>) &#123;</span><br><span class="line">                ctx.throw(<span class="number">404</span>, <span class="string">&#x27;404 | Page Not Found&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Render Error Page or Redirect</span></span><br><span class="line">                ctx.throw(<span class="number">500</span>, <span class="string">&#x27;500 | Internal Server Error&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    app.listen(<span class="number">8080</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="五、Atom，适用于搜索业务的渲染框架"><a href="#五、Atom，适用于搜索业务的渲染框架" class="headerlink" title="五、Atom，适用于搜索业务的渲染框架"></a>五、Atom，适用于搜索业务的渲染框架</h3><p>18年中，<a target="_blank" rel="noopener" href="https://zhaopin.baidu.com/oldindex">旧百度百聘PC站</a>使用Smarty模板+JQuery.js(DOM操作js库)模式开发，大量堆积的DOM操作事件积重难返，对开发维护不是很友好，<a target="_blank" rel="noopener" href="https://zhaopin.baidu.com/">重构后网站域名</a>以及各URL均保持一致。为了与百聘wise站技术框架保持一致，重构采用了大搜团队维护的[Atom]框架，Atom 是适用于搜索业务的渲染框架，它提供了与 Vue.js 类似的模版语法以及基于 PHP 的服务器端渲染。<br><img src=""></img></p>
<p style="margin-left:300px;">Atom基础库架构</p>

<p>Atom 提供了:</p>
<ol>
<li>基于 PHP 的 SSR（后端架构不需要迁移 node，成本低），性能优于<code>node + vue</code></li>
<li>和Vue 类似的模版语法</li>
<li>组件化的开发方式，可以对 html、css代码进行模块化管理</li>
<li>MVVM 数据驱动</li>
<li>前后端同构，方便做一系列的渲染优化</li>
</ol>
<p>目录规范如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">├── api</span><br><span class="line">│   └── fav.js                     // 本地开发mock ajax请求返回.例子：职位收藏接口</span><br><span class="line">├── package.json                   // npm依赖</span><br><span class="line">├── gulpfile.js                    // gulp针对本地 构建的配置文件</span><br><span class="line">├── gulpfile-rd.js                 // gulp针对RD  构建的配置文件</span><br><span class="line">├── BCLOUD</span><br><span class="line">├── build.sh                       // 构建用的 shell</span><br><span class="line">├── tools                          // 所有的本地脚本在这个目录</span><br><span class="line">│   ├── template.php               // 所有页面的入口模板 template for page entry</span><br><span class="line">│   ├── AtomWrapper.class.php      // 渲染 atom php 文件用的脚本</span><br><span class="line">│   ├── get-mock-data.js           // 用于生成 mock 数据</span><br><span class="line">│   ├── webpack.prod.js            // webpack configuration for production</span><br><span class="line">│   ├── webpack.dev.js             // webpack configuration for dev</span><br><span class="line">│   ├── routes.json                // 本地开发的路由配置</span><br><span class="line">│   ├── router.php                 // 路由</span><br><span class="line">│   ├── php-cgi.js                 // run php script through php-cgi </span><br><span class="line">│   ├── server.js                  // 本地开发服务器的入口 express server for development</span><br><span class="line">│   ├── server.php                 // 地开发服务器</span><br><span class="line">│   ├── template.js                // create template to serve every entry with ssr support</span><br><span class="line">│   ├── ajax-middleware.js         // ajax handler for dev</span><br><span class="line">│   └── entry-loader.js            // Entry Loader</span><br><span class="line">│</span><br><span class="line">├── src                            // 所有的源码在这里</span><br><span class="line">│   ├── Home                       // 建议每个页面都用一个目录来承载</span><br><span class="line">│   │   ├── child.atom             // 自有 atom 组件</span><br><span class="line">│   │   ├── index.atom             // 入口 atom 组件[关键][必须]</span><br><span class="line">│   │   ├── index.mock.js          // mock 数据文件，方便FE本地mock开发</span><br><span class="line">│   │   └── data_modify.php        // 建议在这个文件中进行数据结构优化处理</span><br><span class="line">│   ├── common                     // 在多个页面中公共使用的模块</span><br><span class="line">│   │    ├── component             // 公共组件</span><br><span class="line">│   │    │   └── app.atom          // 布局组件</span><br><span class="line">│   │    ├── img                   // 图片资源</span><br><span class="line">│   │    ├── utils                 // 工具函数模块</span><br><span class="line">│   │    │   ├── log.js</span><br><span class="line">│   │    │   └── ...</span><br><span class="line">│   │    └── index.js              // 整站唯一的入口文件</span><br><span class="line">│   └── ...                         // 其他页面...</span><br><span class="line">└── 其他</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>入口 atom：<br>入口 atom 我们是依靠约定 <code>index.atom</code> 为入口来进行标识的，即所有的 <code>index.atom</code> 都是一个页面的入口，*.atom依靠<br>结合/src/common/index.js和对应页面的数据预处理文件data_modify.php:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /src/common/index.js</span></span><br><span class="line"><span class="keyword">import</span> Atom <span class="keyword">from</span> <span class="string">&#x27;atom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./global.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./icon.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">MainComponent, data, props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Atom(&#123;</span><br><span class="line">        el: <span class="string">&#x27;[atom-root]&#x27;</span>,</span><br><span class="line">        data: data,</span><br><span class="line">        components: &#123;</span><br><span class="line">            app: MainComponent</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">render</span>(<span class="params">createElement</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> a = props.reduce(</span><br><span class="line">                (props, prop) =&gt; &#123;</span><br><span class="line">                    props[prop] = <span class="built_in">this</span>[prop];</span><br><span class="line">                    <span class="keyword">return</span> props;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;&#125;</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span> createElement(</span><br><span class="line">                <span class="string">&#x27;app&#x27;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    props: a</span><br><span class="line">                &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createEntry</span>(<span class="params">Component</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        init(Component, ...args);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>data_modify.php示例如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$city</span> = <span class="keyword">$this</span>-&gt;data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;city_name&#x27;</span>];</span><br><span class="line"><span class="variable">$title</span> = <span class="string">&#x27;【找工作_人才招聘_&#x27;</span>.<span class="variable">$city</span>.<span class="string">&#x27;招聘信息】&#x27;</span>;</span><br><span class="line"><span class="variable">$seoDesc</span> = <span class="string">&#x27;全职招聘，名企推荐，靠谱兼职，招聘会，校园招聘，职场资讯，宣讲会&#x27;</span>;</span><br><span class="line"><span class="variable">$keyWords</span> = <span class="variable">$city</span>.<span class="string">&#x27;招聘网|&#x27;</span>.<span class="variable">$city</span>.<span class="string">&#x27;招聘信息|&#x27;</span>.<span class="variable">$city</span>.<span class="string">&#x27;人才网|&#x27;</span>.<span class="variable">$city</span>.<span class="string">&#x27;热门工作&#x27;</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;modify_data[<span class="string">&quot;title&quot;</span>] = <span class="variable">$title</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;modify_data[<span class="string">&#x27;seoDesc&#x27;</span>] = <span class="variable">$seoDesc</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;modify_data[<span class="string">&#x27;keyWords&#x27;</span>] = <span class="variable">$keyWords</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;modify_data[<span class="string">&#x27;city&#x27;</span>] = <span class="variable">$city</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;modify_data[<span class="string">&#x27;tplData&#x27;</span>] = <span class="keyword">$this</span>-&gt;data[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Atom 采用 Single File Component 的形式进行组件的管理，一个 .atom 文件可以定义一个 Atom 组件。<br>.atom 文件包含五部分：</p>
<ol>
<li>template：模版部分，组件的 html（或 xml） 结构</li>
<li>config：组件的数据、依赖等相关内容，服务器端和浏览器端都会使用</li>
<li>script：前端逻辑，只在浏览器端使用</li>
<li>php：服务器端逻辑，只在 php 的服务器端使用，很少会用到</li>
<li>style：组件样式</li>
</ol>
<p>index.atom示例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;home-body&quot;</span>&gt;</span><br><span class="line">        &lt;!-- 头部 --&gt;</span><br><span class="line">        &lt;site-header :curcity=<span class="string">&quot;city&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- main --&gt;</span><br><span class="line">        &lt;main-content /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 事件 --&gt;</span><br><span class="line">        &lt;div @click=<span class="string">&quot;clickHandler&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;simple&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">        &lt;!-- 尾部 --&gt;</span><br><span class="line">        &lt;site-footer /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;config&quot;</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">        tplData: &#123;</span><br><span class="line">            type: <span class="built_in">Object</span>,</span><br><span class="line">            <span class="keyword">default</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    data: &#123;</span><br><span class="line">        city: <span class="string">&#x27;北京&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">        <span class="string">&#x27;site-header&#x27;</span>: <span class="string">&#x27;../common/component/header.atom&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;main-content&#x27;</span>: <span class="string">&#x27;../common/component/main.atom&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;site-footer&#x27;</span>: <span class="string">&#x27;../common/component/footer.atom&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;php&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">computed_url</span>(<span class="params">$ctx</span>) </span>&#123;</span><br><span class="line">    $c = $ctx-&gt;_d[<span class="string">&#x27;curcity&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;/quanzhi?city=&#x27;</span> . $c . <span class="string">&#x27;&amp;query=&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; getQueryValue, getCookie &#125; <span class="keyword">from</span> <span class="string">&#x27;../common/utils/util&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.city = getQueryValue(<span class="string">&#x27;city&#x27;</span>) || <span class="built_in">this</span>.tplData.city_name;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        clickHandler: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style lang=<span class="string">&quot;less&quot;</span> scoped&gt;</span><br><span class="line">.simple</span><br><span class="line">    font-size: 24px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>使用atom编译插件<code>atom-loader</code>来生成<code>*.atom.php</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack配置片段：</span></span><br><span class="line">    rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/index\.atom$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                    path.resolve(<span class="string">&#x27;tools/entry-loader.js&#x27;</span>)</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">                ],</span><br><span class="line">                include: path.resolve(__dirname, <span class="string">&#x27;../src&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.atom$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">&#x27;atom-loader&#x27;</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            compile: &#123;</span><br><span class="line">                                <span class="function"><span class="title">compileJSComponent</span>(<span class="params">val, key</span>)</span> &#123;</span><br><span class="line">                                    <span class="keyword">return</span> <span class="string">`require(&quot;<span class="subst">$&#123;val&#125;</span>&quot;)`</span>;</span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="function"><span class="title">compilePHPComponent</span>(<span class="params">val, key</span>)</span> &#123;</span><br><span class="line">                                    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">                                        + <span class="string">&#x27;dirname(__FILE__) . &quot;/&quot; &#x27;</span></span><br><span class="line">                                        + <span class="string">&#x27;. &#x27;</span> + <span class="built_in">JSON</span>.stringify(val + <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">                                &#125;,</span><br><span class="line">                                compileStyle: atomStyleCompiler</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="function"><span class="title">resolvePhpOutputPath</span>(<span class="params">filePath</span>)</span> &#123;</span><br><span class="line">                                <span class="keyword">let</span> outputFilePath = filePath</span><br><span class="line">                                    .replace(root, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">                                    .replace(<span class="string">&#x27;src&#x27;</span>, <span class="string">&#x27;output/template&#x27;</span>);</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;outputFilePath&#125;</span>.php`</span>;</span><br><span class="line">                            &#125;,</span><br><span class="line">                            loaders: &#123;</span><br><span class="line">                                css: ExtractTextPlugin.extract(&#123;</span><br><span class="line">                                    fallback: <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                                    use: [</span><br><span class="line">                                        <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                                        <span class="string">&#x27;less-loader&#x27;</span>,</span><br><span class="line">                                        &#123;</span><br><span class="line">                                            loader: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    ]</span><br><span class="line">                                &#125;)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>

<p>通用模板template.php如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="comment">/* template for page entry */</span> <span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> htmlentities(<span class="variable">$data</span>[<span class="string">&#x27;title&#x27;</span>]<span class="meta">?&gt;</span>&lt;/title&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;&lt;?php echo htmlentities(<span class="subst">$data</span>[&#x27;seoDesc&#x27;])?&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;&lt;?php echo htmlentities(<span class="subst">$data</span>[&#x27;keyWords&#x27;])?&gt;&quot;</span>/&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;shortcut icon&quot;</span> href=<span class="string">&quot;https://zhaopin.baidu.com/static/newjobs/img/logo/baipin_icon.png&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body data-click=<span class="string">&quot;&#123;&#x27;act&#x27;: &#x27;as&#x27;&#125;&quot;</span>&gt;</span><br><span class="line">&lt;div [atom-root]&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$atom</span>[<span class="string">&#x27;html&#x27;</span>] <span class="meta">?&gt;</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> props = window.__COMPONENT_PROPS__ = <span class="meta">&lt;?php</span> <span class="keyword">echo</span> json_encode(<span class="variable">$atom</span>[<span class="string">&#x27;props&#x27;</span>]) <span class="meta">?&gt;</span>;</span><br><span class="line"><span class="keyword">var</span> data = window.__DATA__ = &#123;&#125;;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$atom</span>[<span class="string">&#x27;props&#x27;</span>] != <span class="literal">null</span> &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$atom</span>[<span class="string">&#x27;props&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$atom</span>[<span class="string">&#x27;props&#x27;</span>] <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$data</span>[<span class="variable">$value</span>])) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;data[&quot;</span> . json_encode(<span class="variable">$value</span>) . <span class="string">&quot;] = &quot;</span> . json_encode(<span class="variable">$data</span>[<span class="variable">$value</span>]) . <span class="string">&quot;;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>缺点是Atom不支持IE8及以下浏览器，理由和Vue.js类似，因为 Vue.js 使用了 IE8 不能模拟的 ECMAScript 5 特性-<code>Object.defineProperty()</code>。</p>
<h3 id="六、百度小程序"><a href="#六、百度小程序" class="headerlink" title="六、百度小程序"></a>六、百度小程序</h3><p>2017年1月9日，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/">微信小程序</a>上线，目前微信小程序已超过100w个；2018年7月4日北京国家会议中心，百度正式发布<a target="_blank" rel="noopener" href="https://smartprogram.baidu.com/">智能小程序</a>；2017年8月18日<a target="_blank" rel="noopener" href="https://docs.alipay.com/mini/developer/getting-started">支付宝小程序</a>开启了内测，9月20日正式对外开放。<br><img src=""></img></p>
<p style="margin-left:260px;">轻应用之小程序</p>

<p>这里我们主要讲我们的百度小程序。百度小程序依托以<code>百度App</code>为代表的全域流量，通过百度AI开放式赋能， 精准连接用户，无需下载安装便可享受智慧超前的使用体验。</p>
<p><img src=""></img></p>
<p style="margin-left:260px;">Demo：手百信息流接入贴吧小程序</p>

<p>一般，在原生小程序语法的开发模式下，目录规范如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">|____app.css // 全局通用样式</span><br><span class="line">|____app.json // 设置 SWAN 的界面、路径、多 TAB</span><br><span class="line">|____project.swan.json // 设置小程序APP ID等</span><br><span class="line">|____pages</span><br><span class="line">|       |____detail</span><br><span class="line">|       |        |____detail.css</span><br><span class="line">|       |        |____detail.swan // 模板文件</span><br><span class="line">|       |        |____detail.js</span><br><span class="line">|       |        |____detail.json // 页面标题栏配置、组件引用等声明</span><br><span class="line">|       |____index</span><br><span class="line">|       |        |____index.css</span><br><span class="line">|       |        |____index.swan</span><br><span class="line">|       |        |____index.js</span><br><span class="line">|       |        |____index.json</span><br><span class="line">|____app.js // 全局的 JS 逻辑</span><br></pre></td></tr></table></figure>

<p>我们看到以下几类的文件：<br>1、 .json 为后缀的 JSON 配置文件，这个文件配置了 SWAN 智能小程序所有页面的路径和界面展现样式等；<br>2、 .swan 结尾的 SWAN 模板文件，这个文件是用来描述当前这个页面的文件结构，类似于网页中的 HTML 文件；<br>3、 .css 结尾的 CSS 样式文件，描述页面样式；<br>4、 .js 结尾的 JS 文件，处理这个页面和用户的交互。<br>小程序在技术架构上非常清晰易懂。JS负责业务逻辑的实现，而表现层则SWAN和CSS来共同实现，SWAN其实就是一种微信定义的模板语言。所以对于擅长前端开发，或者WEB开发的广大开发者而已，小程序的开发可谓降低了不少门槛。<br><img src=""></img></p>
<p style="margin-left:400px;">小程序架构图</p>

<p>从上面的小程序架构图上可以清晰的看出，小程序借助的是JSBridge实现了对底层API接口的调用，所以在小程序里面开发，开发者不用太多去考虑IOS，安卓的实现差异的问题，安心在上层的视图层和逻辑层进行开发即可。<br><img src="" width="600" height="400"></img></p>
<p style="margin-left:260px;">小程序借助JSBridge</p>

<p>目前有『搬家工具』可以让百度小程序和微信小程序『相互转换』，给出差异log，端能力API转换等，但仍不成熟。目前有不少应用层框架支持跨端小程序开发,用类现代框架 (vue/react) 的语法去开发小程序，，比如<a target="_blank" rel="noopener" href="https://nervjs.github.io/taro/docs/README.html">Taro</a>、<a target="_blank" rel="noopener" href="https://ecomfe.github.io/okam/#/">okam</a>，<a target="_blank" rel="noopener" href="https://max-team.github.io/Mars/">mars</a>提升开发体验和解决跨平台的问题，这个后续我们可以研究一下。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>项目的开发模式，取决于团队技术栈是什么样组合，能用什么技术框架，结合产品特点，比如面向用户是谁，PC端是否需要兼容IE，是否需要SEO等等，同时利用组件化、模块化支持大型项目分工协助，最后利用构建工具的自动化，最终打造出多种高效的协助开发模式。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="http://fis.baidu.com/">fis</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/zo2Ke-Pmd_PCmAtUU6HdUw">前端开发模式的迭代</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dailc/p/5930231.html">Hybrid APP基础篇(一)-&gt;什么是Hybrid App</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/dailc/p/5930238.html">Hybrid APP基础篇(二)-&gt;Native、Hybrid、React Native、Web App方案的分析比较</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000002797606">nginx配置location总结及rewrite规则写法</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/erxiaojiedeah/p/9907339.html">什么是前端</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&mid=2651010393&idx=2&sn=b94ae823d621741e853a14ad540ef993">百度Web前端开发实战案例解析</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag"># 框架</a>
              <a href="/tags/%E6%9E%84%E5%BB%BA%E6%89%93%E5%8C%85/" rel="tag"># 构建打包</a>
              <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F/" rel="tag"># 前端开发模式</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/02/12/request/" rel="prev" title="前端请求：Ajax、fetch、Axios">
      <i class="fa fa-chevron-left"></i> 前端请求：Ajax、fetch、Axios
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/03/09/vue2/" rel="next" title="vue2原理浅析">
      vue2原理浅析 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">一、前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%89%8D%E7%AB%AF%E4%B8%89%E8%A6%81%E7%B4%A0%EF%BC%9AHTML%E3%80%81CSS%E3%80%81JS"><span class="nav-number">2.</span> <span class="nav-text">二、前端三要素：HTML、CSS、JS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTML%E4%B9%8B%E4%BA%8E%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-number">2.1.</span> <span class="nav-text">HTML之于模板引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS%E3%80%81CSS%E4%B9%8B%E4%BA%8EES6-Es7-TypeScript%E3%80%81Less-Sass-Stylus"><span class="nav-number">2.2.</span> <span class="nav-text">JS、CSS之于ES6&#x2F;Es7&#x2F;TypeScript、Less&#x2F;Sass&#x2F;Stylus</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%BA%94%E7%94%A8%E5%BD%A2%E6%80%81"><span class="nav-number">3.</span> <span class="nav-text">三、应用形态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E7%A7%BB%E5%8A%A8%E5%BA%94%E7%94%A8"><span class="nav-number">3.1.</span> <span class="nav-text">1、移动应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Web-App"><span class="nav-number">3.1.1.</span> <span class="nav-text">1. Web App</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Native-App"><span class="nav-number">3.1.2.</span> <span class="nav-text">2. Native App</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Hybrid-App%EF%BC%8C%E4%BB%8B%E4%BA%8EWeb-App%E5%92%8CNative-App"><span class="nav-number">3.1.3.</span> <span class="nav-text">3. Hybrid App，介于Web App和Native App</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81PC-Web-%E5%BA%94%E7%94%A8"><span class="nav-number">3.2.</span> <span class="nav-text">2、PC Web 应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8%EF%BC%88SinglePage-Web-Application%EF%BC%8CSPA%EF%BC%89"><span class="nav-number">3.3.</span> <span class="nav-text">1.单页面应用（SinglePage Web Application，SPA）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%A4%9A%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8%EF%BC%88MultiPage-Application%EF%BC%8CMPA%EF%BC%89"><span class="nav-number">3.4.</span> <span class="nav-text">2.多页面应用（MultiPage Application，MPA）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%BF%AD%E4%BB%A3"><span class="nav-number">4.</span> <span class="nav-text">四、前端开发模式的迭代</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BC%A0%E7%BB%9F%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.1.</span> <span class="nav-text">一、传统开发模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB"><span class="nav-number">4.2.</span> <span class="nav-text">二、前后端分离</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-Node-%E7%9A%84%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB"><span class="nav-number">4.2.1.</span> <span class="nav-text">基于 Node 的前后端分离</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E9%A1%B5-Web-%E5%BA%94%E7%94%A8-SinglePage-Web-Application%EF%BC%8CSPA"><span class="nav-number">4.2.2.</span> <span class="nav-text">单页 Web 应用(SinglePage Web Application，SPA)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B%E9%A1%B9%E7%9B%AE%E5%9B%9E%E9%A1%BE"><span class="nav-number">5.</span> <span class="nav-text">五、不同类型项目回顾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E9%87%8D%E5%9E%8BSPA%E7%9A%84MIS"><span class="nav-number">5.1.</span> <span class="nav-text">一、重型SPA的MIS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Hybrid%E5%81%9A%E7%B3%AF%E7%B1%B3APP"><span class="nav-number">5.2.</span> <span class="nav-text">二、Hybrid做糯米APP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81H5%E8%BE%93%E5%87%BA%E5%B9%B3%E5%8F%B0"><span class="nav-number">5.3.</span> <span class="nav-text">三、H5输出平台</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Node%E5%81%9A%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%EF%BC%8C%E5%89%8D%E5%90%8E%E7%AB%AF%E5%90%8C%E6%9E%84"><span class="nav-number">5.4.</span> <span class="nav-text">四、Node做服务端渲染，前后端同构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81Atom%EF%BC%8C%E9%80%82%E7%94%A8%E4%BA%8E%E6%90%9C%E7%B4%A2%E4%B8%9A%E5%8A%A1%E7%9A%84%E6%B8%B2%E6%9F%93%E6%A1%86%E6%9E%B6"><span class="nav-number">5.5.</span> <span class="nav-text">五、Atom，适用于搜索业务的渲染框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E7%99%BE%E5%BA%A6%E5%B0%8F%E7%A8%8B%E5%BA%8F"><span class="nav-number">5.6.</span> <span class="nav-text">六、百度小程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">7.</span> <span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Gao lu</p>
  <div class="site-description" itemprop="description">时间就像一张网，你撒在哪里，你的收获就在哪里。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gao lu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
